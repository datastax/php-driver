<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="DataStax PHP Driver for Apache Cassandra">
    <meta name="author" content="DataStax">

    <title>DataStax PHP Driver - Features</title>

    <link rel="icon" href="../favicon.ico">
    <link rel="apple-touch-icon" href="../favicon.png">
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs" data-spy="scroll" data-target="#table-of-contents" data-offset="69">
    <header class="container-fluid navbar">
      <div class="row">
        <div class="col-sm-4">
          <a class="navbar-brand" href="../"><img alt="Brand" src="../img/logo.png">DataStax PHP Driver</a>
        </div>
        <div class="col-md-4 col-md-offset-4">
          <div class="row">
            <div class="col-md-12">
              <ul class="list-inline" role="nav">
                <li><a href="https://academy.datastax.com/" class="navbar-link">DataStax Academy</a></li>
                <li><a href="http://www.datastax.com/dev/blog" class="navbar-link">Tech Blog</a></li>
                <li><a href="http://www.datastax.com/what-we-offer/products-services/support" class="navbar-link">Support</a></li>
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-8">
              <form id="search" class="form-search dropdown visible-lg-block" ng-controller="search" ng-class="{open: hasResults}" role="search" ng-submit="submit()" data-spy="affix" data-offset-top="130">
                <div class="form-group has-feedback">
                  <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('v1.1.0')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
                </div>
                <ul class="dropdown-menu search-results" role="menu">
                  <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
                </ul>
              </form>
            </div>
            <div class="col-md-4">
              <a href="http://www.datastax.com/download" class="btn btn-primary btn-sm">Download</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row crumbs-wrapper">
        <div class="col-md-12">
          <nav id="crumbs" data-spy="affix" data-offset-top="130">
            <ol class="breadcrumb">
              
              <li>
                <div class="btn-group">
                  <button id="current-version" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    v1.1.0
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                  
                    <li class="disabled"><a href="./">v1.1.0</a></li>
                  
                    <li><a href="../v1.0.1/features/">v1.0.1</a></li>
                  
                    <li><a href="../v1.0.0/features/">v1.0.0</a></li>
                  
                    <li><a href="../v1.0.0-rc/features/">v1.0.0-rc</a></li>
                  
                  </ul>
                </div>
              </li>
              
              
              
              
              <li><a href="../">Home</a></li>
              
              
              
              
              
              <li class="active">Features</li>
              <li class="dropdown" id="table-of-contents">
                <div class="btn-group">
                  <button id="current-section" type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                    Jump to&#8230; <span class="caret"></span><span class="sr-only">Table of Contents</span>
                  </button>
                  <ul class="dropdown-menu nav nav-pills nav-stacked">
                    <li><a href="#features">Page Top <span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span></a></li>
<li>
<a href="#usage">Usage
</a><ul class="nav nav-pills nav-stacked">
<li><a href="#specifying-addresses-of-cassandra-nodes">Specifying addresses of Cassandra nodes
</a></li>
<li><a href="#discovering-nodes-in-the-cluster">Discovering nodes in the cluster
</a></li>
<li><a href="#persistent-sessions">Persistent sessions
</a></li>
<li><a href="#configuring-load-balancing-policy">Configuring load balancing policy
</a></li>
<li><a href="#setting-protocol-version">Setting protocol version
</a></li>
<li><a href="#tweaking-driver-s-throughput">Tweaking driver’s throughput
</a></li>
<li><a href="#disabling-tcp-nodelay">Disabling TCP nodelay
</a></li>
<li><a href="#enabling-tcp-keepalive">Enabling TCP keepalive
</a></li>
<li><a href="#authenticating-via-password-authenticator">Authenticating via PasswordAuthenticator

</a></li>
<li><a href="#enabling-ssl-encryption">Enabling SSL encryption
</a></li>
<li><a href="#executing-queries">Executing queries
</a></li>
<li><a href="#parameterized-queries">Parameterized queries
</a></li>
<li><a href="#prepared-statements">Prepared statements
</a></li>
<li><a href="#executing-statements-in-parallel">Executing statements in parallel
</a></li>
<li><a href="#creating-keyspaces-and-tables">Creating keyspaces and tables
</a></li>
<li><a href="#batch-statements">Batch statements
</a></li>
<li><a href="#result-paging">Result paging
</a></li>
<li><a href="#consistency">Consistency
</a></li>
<li><a href="#schema-metadata">Schema Metadata
</a></li>
<li><a href="#data-types">Data Types
</a></li>
<li><a href="#logging">Logging
</a></li>
</ul>
</li>
<li>
<a href="#architecture">Architecture
</a><ul class="nav nav-pills nav-stacked"><li><a href="#persistent-sessions">Persistent sessions
</a></li></ul>
</li>
                  </ul>
                </div>
              </li>
              
              
              
            </ol>
          </nav>
        </div>
      </div>
    </header>

    <div class="container-fluid" id="content">
      <div class="row">
        <div class="col-md-3">
          <div id="navigation" class="side-nav" role="tablist" aria-multiselectable="true">
            <h3>Contents</h3>
            <ul class="nav nav-pills nav-stacked">
  
  
  
  <li>
    <a href="../api/">API docs <small>index</small></a>
  </li>
  
  
  
  
  <li class="active">
    <a href="./" class="current">Features <small>page</small></a>
    <ul class="nav nav-pills nav-stacked">
  
  
  
  <li>
    <a href="datatypes/">Datatypes <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="consistency_level/">Consistency Level <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="client_side_timestamps/">Client-side timestamps <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="simple_statements/">Simple Statements <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="prepared_statements/">Prepared Statements <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="batch_statements/">Batch statements <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="logging/">Logging <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="result_paging/">Result paging <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="schema_metadata/">Schema Metadata <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="sessions/">Sessions <small>page</small></a>
  </li>
  
  
  
  
  <li>
    <a href="ssl_encryption/">SSL encryption <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="user_defined_types/">User defined types <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="tuples/">Tuples <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="collections/">Collections <small>feature</small></a>
  </li>
  
  
  
  
  <li>
    <a href="retry_polices/">Retry Policies <small>feature</small></a>
  </li>
  
  
</ul>

  </li>
  
  
</ul>

          </div>
        </div>
        <div class="col-md-9 content">
          

<h1 id="features" class="target">Features<a class="anchor" href="#features" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>

<h2 id="usage" class="target">Usage<a class="anchor" href="#usage" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<h3 id="specifying-addresses-of-cassandra-nodes" class="target">Specifying addresses of Cassandra nodes<a class="anchor" href="#specifying-addresses-of-cassandra-nodes" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p><a href="../api/Cassandra/Cluster/class.Builder/#method.withContactPoints"><code>withContactPoints()</code></a> and <a href="../api/Cassandra/Cluster/class.Builder/#method.withPort"><code>withPort()</code></a> methods of the <a href="../api/Cassandra/Cluster/class.Builder/"><code>Cassandra\Cluster\Builder</code></a> are used to specify IP addresses or hostnames and port number of the nodes in a given Cassandra cluster.</p>

<p>Note that you don’t have to specify the addresses of all hosts in your cluster. Once the driver has established a connection to any host, it will perform auto-discovery and connect to all hosts in the cluster.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withContactPoints</span><span class="p">(</span><span class="s1">'10.0.1.24'</span><span class="p">,</span> <span class="s1">'example.com'</span><span class="p">,</span> <span class="s1">'localhost'</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">withPort</span><span class="p">(</span><span class="mi">9042</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="discovering-nodes-in-the-cluster" class="target">Discovering nodes in the cluster<a class="anchor" href="#discovering-nodes-in-the-cluster" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>After the initial connection to one of the hosts specified via <code>withContactPoints()</code> succeeds, the driver discovers the addresses and connects to all members of the cluster automatically. You can also see the nodes that the driver discovered by running <code>SELECT * FROM system.peers</code>.</p>

<h3 id="persistent-sessions" class="target">Persistent sessions<a class="anchor" href="#persistent-sessions" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>In order to limit the startup time and total number of connections to a Cassandra cluster, the PHP Driver enables persistent sessions by default. All cluster and sessions using the same initial configuration will be shared across requests when persistent sessions are enabled. You can toggle this setting using <a href="../api/Cassandra/Cluster/class.Builder/#method.withPersistentSessions"><code>Cassandra\Cluster\Builder::withPersistentSessions()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withPersistentSessions</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<p>Note that disabling persistent sessions will cause a significant slow down of cluster initialization as the connections will be forced to get re-established for every request.</p>

<p>Once persistent sessions are enabled, you can view how many of them are currently active. They will be exposed in the Cassandra extension section of <code>phpinfo()</code>.</p>

<p>Persistent sessions stay alive for the duration of the parent process, typically a php-fpm worker or apache worker. These sessions will be reused for all requests served by that worker process. Once a worker process has reached its end of life, sessions will get cleaned up automatically and will be re-create in the new process.</p>

<h3 id="configuring-load-balancing-policy" class="target">Configuring load balancing policy<a class="anchor" href="#configuring-load-balancing-policy" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The PHP Driver comes with a variety of load balancing policies. By default it uses a combination of latency aware, token aware and data center aware round robin load balancing.</p>

<p>The token aware load balancing policy uses the same hashing algorithms as the Apache Cassandra to directly route the execution of prepared statements to the replica node, avoiding an additional network hop to/from the coordinator. You can toggle its usage with <a href="../api/Cassandra/Cluster/class.Builder/#method.withTokenAwareRouting"><code>Cassandra\Cluster\Builder::withTokenAwareRouting()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withTokenAwareRouting</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<p>The default datacenter aware round robin load balancing policy is configured to keep all traffic in the same datacenter. Upon connecting to a host from the initial list of contact points, the driver will consider that host’s datacenter to be local. Only hosts from the same datacenter will be connected to and used for executing statements. You can override the name of the local datacenter. The number of hosts from remote datacenters that the driver may use and whether it should execute statements with local consistencies on those hosts in case none of the local hosts are available. All of that is configurable via <a href="../api/Cassandra/Cluster/class.Builder/#method.withDatacenterAwareRoundRobinLoadBalancingPolicy"><code>Cassandra\Cluster\Builder::withDatacenterAwareRoundRobinLoadBalancingPolicy()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withDatacenterAwareRoundRobinLoadBalancingPolicy</span><span class="p">(</span><span class="s2">"us-west"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<p>You may disable datacenter awareness by calling <a href="../api/Cassandra/Cluster/class.Builder/#method.withRoundRobinLoadBalancingPolicy"><code>Cassandra\Cluster\Builder::withRoundRobinLoadBalancingPolicy()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withRoundRobinLoadBalancingPolicy</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<p>Finally, latency-aware routing ensures that requests are routed to the hosts that respond the fastest. You can switch it off via <a href="../api/Cassandra/Cluster/class.Builder/#method.withLatencyAwareRouting"><code>Cassandra\Cluster\Builder::withLatencyAwareRouting()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withLatencyAwareRouting</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="setting-protocol-version" class="target">Setting protocol version<a class="anchor" href="#setting-protocol-version" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The PHP driver will automatically negotiate native protocol version of TCP connections to the latest supported by both the driver and Apache Cassandra servers. It does this by attempting connection at the highest supported protocol version (currently 2) and negotiating it down upon unsupported version responses from the server.</p>

<p>In a scenario with an Apache Cassandra cluster consisting of nodes of mixed versions (e.g. 1.2.x and 2.0.x), this might pose problems as the driver could establish native protocol version to be 2, while some of the nodes don’t support it, causing connections to the rest of the cluster to fail.</p>

<p>You can force the driver to start negotiation at a lower protocol version by using <a href="../api/Cassandra/Cluster/class.Builder/#method.withProtocolVersion"><code>Cassandra\Cluster\Builder::withProtocolVersion()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withProtocolVersion</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="tweaking-driver-s-throughput" class="target">Tweaking driver’s throughput<a class="anchor" href="#tweaking-driver-s-throughput" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>There are a few variables affecting the total throughput of the driver that can be tweaked client-side. The maximum number of requests that can be executed at the same time is calculated with the following formula:</p>
<pre><code>inflight_requests = io_threads * requests_per_connection * maximum_number_of_connections_per_host * connected_hosts
</code></pre>
<p>Where <code>io_threads</code> by default is <code>1</code>, <code>requests_per_connection</code> for the currently supported protocol versions is <code>128</code>, <code>maximum_number_of_connections_per_host</code> by default is <code>2</code> and <code>connected_hosts</code> is the total number of hosts that can be connected to. This last variable depends on the load balancing policy used, data center aware policy only connects to the hosts in the same data center by default.</p>

<p>You can change the value of <code>io_threads</code> from the formula above by using <a href="../api/Cassandra/Cluster/class.Builder/#method.withIOThreads"><code>Cassandra\Cluster\Builder::withIOThreads()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withIOThreads</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<p>You can change the value of <code>maximum_number_of_connections_per_host</code> from the formula above by using <a href="../api/Cassandra/Cluster/class.Builder/#method.withConnectionsPerHost"><code>Cassandra\Cluster\Builder::withConnectionsPerHost()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withConnectionsPerHost</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="disabling-tcp-nodelay" class="target">Disabling TCP nodelay<a class="anchor" href="#disabling-tcp-nodelay" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>By default, the driver enables TCP nodelay (Nagle’s algorithm) on all connections it uses. Disabling it is not recommended but possible via <a href="../api/Cassandra/Cluster/class.Builder/#method.withTCPNodelay"><code>Cassandra\Cluster\Builder::withTCPNodelay()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withTCPNodelay</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="enabling-tcp-keepalive" class="target">Enabling TCP keepalive<a class="anchor" href="#enabling-tcp-keepalive" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>By default, TCP keepalive is disabled. It can be useful to make sure TCP connections are not silently dropped by a firewall or some other intermediary network device. You can enable it using <a href="../api/Cassandra/Cluster/class.Builder/#method.withTCPKeepalive"><code>Cassandra\Cluster\Builder::withTCPKeepalive()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="c1">// enable keepalive with a 10 second interval.
</span>
<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withTCPKeepalive</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="authenticating-via-password-authenticator" class="target">Authenticating via <code>PasswordAuthenticator</code>
<a class="anchor" href="#authenticating-via-password-authenticator" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The PHP Driver supports Apache Cassandra’s built-in password authentication mechanism. To enable it, use <a href="../api/Cassandra/Cluster/class.Builder/#method.withCredentials"><code>Cassandra\Cluster\Builder::withCredentials()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withCredentials</span><span class="p">(</span><span class="s2">"username"</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="enabling-ssl-encryption" class="target">Enabling SSL encryption<a class="anchor" href="#enabling-ssl-encryption" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The PHP Driver supports SSL encryption of network connections. You must configure <a href="../api/Cassandra/class.SSLOptions/"><code>Cassandra\SSLOptions</code></a> using the <a href="../api/Cassandra/SSLOptions/class.Builder/"><code>Cassandra\SSLOptions\Builder</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$ssl</span>     <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">ssl</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withTrustedCerts</span><span class="p">(</span><span class="s1">'node1.pem'</span><span class="p">,</span> <span class="s1">'node2.pem'</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">withVerifyFlags</span><span class="p">(</span><span class="nx">Cassandra</span><span class="o">::</span><span class="na">VERIFY_PEER_CERT</span> <span class="o">|</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">VERIFY_PEER_IDENTITY</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">withClientCert</span><span class="p">(</span><span class="s1">'client.pem'</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">withPrivateKey</span><span class="p">(</span><span class="s1">'id_rsa'</span><span class="p">,</span> <span class="s1">'passphrase'</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">()</span>
<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withSSL</span><span class="p">(</span><span class="nv">$ssl</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<h3 id="executing-queries" class="target">Executing queries<a class="anchor" href="#executing-queries" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>You run CQL statements by passing them to <a href="../api/Cassandra/interface.Session/"><code>Cassandra\Session::execute()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s1">'SELECT keyspace_name, columnfamily_name FROM system.schema_columnfamilies'</span><span class="p">));</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"The keyspace </span><span class="se">\"</span><span class="s2">%s</span><span class="se">\"</span><span class="s2"> has a table </span><span class="se">\"</span><span class="s2">%s</span><span class="se">\"</span><span class="s2">.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'keyspace_name'</span><span class="p">],</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'columnfamily_name'</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre>
<h3 id="parameterized-queries" class="target">Parameterized queries<a class="anchor" href="#parameterized-queries" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p><strong>If you’re using Cassandra 2.0 or later</strong> you no longer have to build CQL strings when you want to insert a value in a query, there’s a new feature that lets you bind values with regular statements:</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s2">"UPDATE users SET age = ? WHERE user_name = ?"</span><span class="p">),</span>
    <span class="k">new</span> <span class="nx">Cassandra\ExecutionOptions</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="s1">'Sam'</span><span class="p">)</span>
    <span class="p">))</span>
<span class="p">);</span>
</code></pre>
<p>For frequently executed queries, it’s strongly recommended to use prepared statements. As a rule of thumb, if your application is sending a request more than once, a prepared statement is almost always the right choice.</p>

<h3 id="prepared-statements" class="target">Prepared statements<a class="anchor" href="#prepared-statements" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The driver supports prepared statements. Use <a href="../api/Cassandra/interface.Session/#method.prepare"><code>Cassandra\Session::prepare()</code></a> to create a <a href="../api/Cassandra/class.PreparedStatement/"><code>Cassandra\PreparedStatement</code></a> object, and then call <a href="../api/Cassandra/interface.Session/#method.execute"><code>Cassandra\Session::execute()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'INSERT INTO users (username, email) VALUES (?, ?)'</span><span class="p">);</span>

<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$statement</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Cassandra\ExecutionOptions</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'avalanche123'</span><span class="p">,</span> <span class="s1">'bulat.shakirzyanov@datastax.com'</span><span class="p">)</span>
<span class="p">)));</span>
</code></pre>
<p>A prepared statement can be run many times, but the CQL parsing will only be done once on each node. Use prepared statements for queries you run over and over again.</p>

<h3 id="executing-statements-in-parallel" class="target">Executing statements in parallel<a class="anchor" href="#executing-statements-in-parallel" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>With fully asynchronous API, it is very easy to run queries in parallel:</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="s1">'Sam'</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="s1">'Bob'</span><span class="p">)</span>
<span class="p">);</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"UPDATE users SET age = ? WHERE user_name = ?"</span><span class="p">);</span>
<span class="nv">$futures</span>   <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="c1">// execute all statements in background
</span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$arguments</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$futures</span><span class="p">[]</span><span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">executeAsync</span><span class="p">(</span><span class="nv">$statement</span><span class="p">,</span> <span class="k">new</span> <span class="nx">ExecutionOptions</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
                    <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="nv">$arguments</span>
                <span class="p">)));</span>
<span class="p">}</span>

<span class="c1">// wait for all statements to complete
</span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$futures</span> <span class="k">as</span> <span class="nv">$future</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// we will not wait for each result for more than 5 seconds
</span>    <span class="nv">$future</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<p>Note that it is not enough to simply create a <a href="../api/Cassandra/interface.Future/"><code>Cassandra\Future</code></a> by calling one of the <code>*Async()</code> methods, you must ensure that this future has enough time to be executed by calling <a href="../api/Cassandra/interface.Future/#method.get"><code>Cassandra\Future::get()</code></a>.</p>

<h3 id="creating-keyspaces-and-tables" class="target">Creating keyspaces and tables<a class="anchor" href="#creating-keyspaces-and-tables" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>There is no special facility for creating keyspaces and tables, they are created by executing CQL:</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$createKeyspace</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="sh">&lt;&lt;&lt;EOD
CREATE KEYSPACE measurements
WITH replication = {
  'class': 'SimpleStrategy',
  'replication_factor': 1
}
EOD
</span><span class="p">);</span>

<span class="nv">$createTable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="sh">&lt;&lt;&lt;EOD
CREATE TABLE events (
  id INT,
  date DATE,
  comment VARCHAR,
  PRIMARY KEY (id)
)
EOD
</span><span class="p">);</span>

<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$createKeyspace</span><span class="p">);</span>
<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s1">'USE measurements'</span><span class="p">);</span>
<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$createTable</span><span class="p">);</span>
</code></pre>
<p>You can also <code>ALTER</code> keyspaces and tables, and you can read more about that in the <a href="https://github.com/apache/cassandra/blob/cassandra-2.0/doc/cql3/CQL.textile">CQL3 syntax documentation</a>.</p>

<h3 id="batch-statements" class="target">Batch statements<a class="anchor" href="#batch-statements" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p><strong>If you’re using Cassandra 2.0 or later</strong> you can build batch requests, either from simple or prepared statements. Batches must not contain any select statements, only <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> statements are allowed.</p>

<p>You can mix any combination of statements in a batch:</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\BatchStatement</span><span class="p">();</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"UPDATE users SET name = ? WHERE user_id = ?"</span><span class="p">);</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$statement</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Sue'</span><span class="p">,</span> <span class="s1">'unicorn31'</span><span class="p">));</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s2">"UPDATE users SET age = 19 WHERE user_id = 'unicorn31'"</span><span class="p">);</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$statement</span><span class="p">);</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s2">"INSERT INTO activity (user_id, what, when) VALUES (?, 'login', NOW())"</span><span class="p">);</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$statement</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'unicorn31'</span><span class="p">));</span>

<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$batch</span><span class="p">);</span>
</code></pre>
<p>Batches can have one of three different types: <code>logged</code>, <code>unlogged</code> or <code>counter</code>, where <code>logged</code> is the default. Their exact semantics are defined in the <a href="http://docs.datastax.com/en/cql/3.1/cql/cql_reference/batch_r.html">Cassandra documentation</a>, but this is how you specify which one you want:</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\BatchStatement</span><span class="p">(</span><span class="nx">Cassandra</span><span class="o">::</span><span class="na">BATCH_LOGGED</span><span class="p">);</span>
<span class="nv">$batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\BatchStatement</span><span class="p">(</span><span class="nx">Cassandra</span><span class="o">::</span><span class="na">BATCH_UNLOGGED</span><span class="p">);</span>
<span class="nv">$batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\BatchStatement</span><span class="p">(</span><span class="nx">Cassandra</span><span class="o">::</span><span class="na">BATCH_COUNTER</span><span class="p">);</span>
</code></pre>
<p><a href="../api/Cassandra/class.BatchStatement/">Read more about <code>Cassandra\BatchStatement</code></a></p>

<p>Cassandra 1.2 also supported batching, but only as a CQL feature, you had to build the batch as a string, and it didn’t really play well with prepared statements.</p>

<h3 id="result-paging" class="target">Result paging<a class="anchor" href="#result-paging" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p><strong>If you’re using Cassandra 2.0</strong> or later you can page your query results.</p>

<p>By default, a page size of 5000 will be used, you can override the default page size via <a href="../api/Cassandra/Cluster/class.Builder/#method.withDefaultPageSize"><code>Cassandra\Cluster\Builder::withDefaultPageSize()</code></a>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withDefaultPageSize</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<p>You can also override the page size on a per-execute basis by adding the <code>page_size</code> option to <a href="../api/Cassandra/class.ExecutionOptions/"><code>Cassandra\ExecutionOptions</code></a>:</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s2">"SELECT * FROM large_table WHERE id = 'partition_with_lots_of_data'"</span><span class="p">);</span>
<span class="nv">$result</span>    <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$statement</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Cassandra\ExecutionOptions</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'page_size'</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">)));</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">nextPage</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
<p><a href="../api/Cassandra/class.Rows/#method.nextPage">Read more about <code>Cassandra\Rows::nextPage()</code></a></p>

<h3 id="consistency" class="target">Consistency<a class="anchor" href="#consistency" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>You can specify the default consistency to use for statements execution when you create a new <code>Cassandra\Cluster</code>:</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$cluster</span> <span class="o">=</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">cluster</span><span class="p">()</span>
               <span class="o">-&gt;</span><span class="na">withDefaultConsistency</span><span class="p">(</span><span class="nx">Cassandra</span><span class="o">::</span><span class="na">CONSISTENCY_LOCAL_QUORUM</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$cluster</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</code></pre>
<p><a href="../api/Cassandra/Cluster/class.Builder/#method.withDefaultConsistency">Read more <code>Cassandra\Cluster\Builder::withDefaultConsistency()</code></a></p>

<p>Consistency can also be passed via <code>Cassandra\ExecutionOptions</code>.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s1">'SELECT * FROM users'</span><span class="p">),</span>
    <span class="k">new</span> <span class="nx">Cassandra\ExecutionOptions</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'consistency'</span> <span class="o">=&gt;</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">CONSISTENCY_LOCAL_QUORUM</span><span class="p">))</span>
<span class="p">);</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'SELECT * FROM users'</span><span class="p">);</span>
<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$statement</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Cassandra\ExecutionOptions</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'consistency'</span> <span class="o">=&gt;</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">CONSISTENCY_LOCAL_QUORUM</span>
<span class="p">)));</span>

<span class="nv">$batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cassandra\BatchStatement</span><span class="p">();</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s2">"UPDATE users SET email = 'sue@foobar.com' WHERE id = 'sue'"</span><span class="p">));</span>
<span class="nv">$batch</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Cassandra\SimpleStatement</span><span class="p">(</span><span class="s2">"UPDATE users SET email = 'tom@foobar.com' WHERE id = 'tom'"</span><span class="p">));</span>
<span class="nv">$session</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$batch</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Cassandra\ExecutionOptions</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'consistency'</span> <span class="o">=&gt;</span> <span class="nx">Cassandra</span><span class="o">::</span><span class="na">CONSISTENCY_LOCAL_QUORUM</span>
<span class="p">)));</span>
</code></pre>
<p><a href="../api/Cassandra/class.ExecutionOptions/">Read more about <code>Cassandra\ExecutionOptions</code></a></p>

<p><a href="../api/Cassandra/interface.Session/#method.execute">Read more about <code>Cassandra\Session::execute()</code></a></p>

<p>The default consistency level unless you’ve set it yourself is <code>Cassandra::CONSISTENCY_LOCAL_ONE</code>.</p>

<p>Consistency is ignored for <code>USE</code>, <code>TRUNCATE</code>, <code>CREATE</code> and <code>ALTER</code> statements, and some (like <code>Cassandra::CONSISTENCY_ANY</code>) aren’t allowed in all situations.</p>

<h3 id="schema-metadata" class="target">Schema Metadata<a class="anchor" href="#schema-metadata" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The DataStax PHP driver exposes schema metadata via <a href="../api/Cassandra/interface.Schema/"><code>Cassandra\Schema</code></a> object, available using <a href="../api/Cassandra/interface.Session/#method.schema"><code>Cassandra\Session::schema()</code></a>.
Schema metadata includes information about keyspace, tables and columns and it automatically kept up-to-date with the Cassandra cluster.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$schema</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">schema</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$schema</span><span class="o">-&gt;</span><span class="na">keyspaces</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$keyspace</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"Keyspace: %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$keyspace</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">());</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"    Replication Strategy: %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$keyspace</span><span class="o">-&gt;</span><span class="na">replicationClassName</span><span class="p">());</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"    Replication Options:</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
    <span class="nv">$options</span> <span class="o">=</span> <span class="nv">$keyspace</span><span class="o">-&gt;</span><span class="na">replicationOptions</span><span class="p">();</span>
    <span class="nv">$keys</span>    <span class="o">=</span> <span class="nv">$options</span><span class="o">-&gt;</span><span class="na">keys</span><span class="p">();</span>
    <span class="nv">$values</span>  <span class="o">=</span> <span class="nv">$options</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">();</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_combine</span><span class="p">(</span><span class="nv">$keys</span><span class="p">,</span> <span class="nv">$values</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        %s: %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"    Durable Writes:       %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$keyspace</span><span class="o">-&gt;</span><span class="na">hasDurableWrites</span><span class="p">()</span> <span class="o">?</span> <span class="s1">'true'</span> <span class="o">:</span> <span class="s1">'false'</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$keyspace</span><span class="o">-&gt;</span><span class="na">tables</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"    Table: %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Comment:                    %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">comment</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Read Repair Chance:         %f</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">readRepairChance</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Local Read Repair Chance:   %f</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">localReadRepairChance</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        GC Grace Seconds:           %d</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">gcGraceSeconds</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Caching:                    %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">caching</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Bloom Filter FP Chance:     %f</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">bloomFilterFPChance</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Memtable Flush Period Ms:   %d</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">memtableFlushPeriodMs</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Default Time To Live:       %d</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">defaultTTL</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Speculative Retry:          %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">speculativeRetry</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Index Interval:             %d</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">indexInterval</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Compaction Strategy:        %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">compactionStrategyClassName</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Populate IO Cache On Flush: %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">populateIOCacheOnFlush</span><span class="p">()</span> <span class="o">?</span> <span class="s1">'yes'</span> <span class="o">:</span> <span class="s1">'no'</span><span class="p">);</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Replicate On Write:         %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">replicateOnWrite</span><span class="p">()</span> <span class="o">?</span> <span class="s1">'yes'</span> <span class="o">:</span> <span class="s1">'no'</span><span class="p">);</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Max Index Interval:         %d</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">maxIndexInterval</span><span class="p">());</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Min Index Interval:         %d</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">minIndexInterval</span><span class="p">());</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">columns</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">printf</span><span class="p">(</span><span class="s2">"        Column: %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$column</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">());</span>
            <span class="nb">printf</span><span class="p">(</span><span class="s2">"            Type:          %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$column</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">());</span>
            <span class="nb">printf</span><span class="p">(</span><span class="s2">"            Order:         %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isReversed</span><span class="p">()</span> <span class="o">?</span> <span class="s1">'desc'</span> <span class="o">:</span> <span class="s1">'asc'</span><span class="p">);</span>
            <span class="nb">printf</span><span class="p">(</span><span class="s2">"            Frozen:        %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isFrozen</span><span class="p">()</span> <span class="o">?</span> <span class="s1">'yes'</span> <span class="o">:</span> <span class="s1">'no'</span><span class="p">);</span>
            <span class="nb">printf</span><span class="p">(</span><span class="s2">"            Static:        %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isStatic</span><span class="p">()</span> <span class="o">?</span> <span class="s1">'yes'</span> <span class="o">:</span> <span class="s1">'no'</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">indexName</span><span class="p">())</span> <span class="p">{</span>
                <span class="nb">printf</span><span class="p">(</span><span class="s2">"            Index:         %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$column</span><span class="o">-&gt;</span><span class="na">indexName</span><span class="p">());</span>
                <span class="nb">printf</span><span class="p">(</span><span class="s2">"            Index Options: %s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$column</span><span class="o">-&gt;</span><span class="na">indexOptions</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><strong>NOTE</strong> A new instance of <a href="../api/Cassandra/interface.Schema/"><code>Cassandra\Schema</code></a> is returned each time <a href="../api/Cassandra/interface.Session/#method.schema"><code>Cassandra\Session::schema()</code></a> is called. This instance is a simple value object and its information, such as keyspaces, tables and columns will not be kept up-to-date with the state of the cluster. In order to obtain the latest schema metadata, you have to call <a href="../api/Cassandra/interface.Session/#method.schema"><code>Cassandra\Session::schema()</code></a> again.</p>

<h3 id="data-types" class="target">Data Types<a class="anchor" href="#data-types" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The PHP driver for Apache Cassandra supports <a href="datatypes/">a variety of datatypes</a>.</p>

<p>You can also use the rich type metadata API to define and inspect types, as well as validate data objects.</p>

<p>The example below defines and creates a <a href="../api/Cassandra/class.Map/"><code>Cassandra\Map</code></a> using <a href="../api/Cassandra/interface.Type/"><code>Cassandra\Type</code></a> interface.</p>
<pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$map</span> <span class="o">=</span> <span class="nx">Cassandra\Type</span><span class="o">::</span><span class="na">map</span><span class="p">(</span><span class="nx">Cassandra\Type</span><span class="o">::</span><span class="na">varchar</span><span class="p">(),</span> <span class="nx">Cassandra\Type</span><span class="o">::</span><span class="na">int</span><span class="p">())</span>
                     <span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nb">array_combine</span><span class="p">(</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">keys</span><span class="p">(),</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">()));</span>
</code></pre>
<p><strong>NOTE</strong> The <code>create()</code> method or various types validates and coerces provided values into the target type.</p>

<h3 id="logging" class="target">Logging<a class="anchor" href="#logging" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>You can configure the location of the log file for the driver as well as the log level using the following <code>php.ini</code> settings:</p>
<pre class="highlight"><code><span class="nn">[cassandra]</span>
<span class="py">cassandra.log</span><span class="p">=</span><span class="s">syslog</span>
<span class="py">cassandra.log_level</span><span class="p">=</span><span class="s">INFO</span>
</code></pre>
<p>You can specify any file path as <code>cassandra.log</code>.</p>

<p>The special value <code>syslog</code> can be used to for the driver to use syslog for logging. Syslog is only supported on *nix systems.</p>

<p>The possible log levels are:</p>

<ul>
<li>CRITICAL</li>
<li>ERROR</li>
<li>WARN</li>
<li>INFO</li>
<li>DEBUG</li>
<li>TRACE</li>
</ul>

<p>Most of the logging will be when the driver connects and discovers new nodes, when connections fail and so on. The logging is designed to not cause much overhead and only relatively rare events are logged (e.g. normal requests are not logged).</p>

<h2 id="architecture" class="target">Architecture<a class="anchor" href="#architecture" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>The PHP Driver follows the architecture of <a href="http://datastax.github.io/cpp-driver/topics/#architecture">the C/C++ Driver</a> that it wraps.</p>

<h3 id="persistent-sessions" class="target">Persistent sessions<a class="anchor" href="#persistent-sessions" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>By default, the driver uses persistent sessions to prevent each request from creating completely new TCP connections to a Cassandra cluster. You can toggle this functionality using <a href="../api/Cassandra/Cluster/class.Builder/#method.withPersistentSessions"><code>Cassandra\Cluster\Builder::withPersistentSessions</code></a></p>


        </div>
      </div>
    </div>

    
    <footer class="container text-muted">
      <ul class="list-inline">
      
        
        <li>
          <a href="http://downloads.datastax.com/php-driver/">Binaries</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/php-driver/">Code</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="http://datastax.github.io/php-driver/">Docs</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/PHP/">Issues</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/php-driver-user">Mailing List</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/php-driver/releases">Releases</a>
        </li>
      
      </ul>
    </footer>
    

    <script src="../js/jquery.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../js/angular.js"></script>
    <script src="../js/mousetrap.js"></script>
    <script src="../js/hotkeys.js"></script>
    <script src="../js/ZeroClipboard.js"></script>
    <script src="../js/lunr.js"></script>
    <script src="../js/app.js"></script>
  </body>
</html>
